# ë¹„ë™ê¸°

ë¸Œë¼ìš°ì € í™˜ê²½ì—ì„œëŠ” ì–¼ë§ˆë‚˜ ê±¸ë¦´ì§€ ì˜ˆì¸¡í•  ìˆ˜ ì—†ëŠ” ìš”ì†Œê°€ ë§ë‹¤. ëŒ€í‘œì ìœ¼ë¡œëŠ” ì‚¬ìš©ì ì…ë ¥ ëŒ€ê¸°ì™€ ì„œë²„ API ì‘ë‹µ, íŒŒì¼ ì¡°íšŒ ë“±ì´ ìˆë‹¤. ì´ëŸ¬í•œ ìœ í˜•ì˜ ì‘ì—…ë“¤ì„ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì´ ì½”ë“œë¥¼ ì‹¤í–‰í•  ë•Œ ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê²Œ ëœë‹¤ë©´ í”„ë¡œê·¸ë¨ì„ ì‚¬ìš©í•˜ì§€ë„ ëª»í•˜ê³  **ëª¨ë“  ì‘ì—…ì´ ë§ˆë¬´ë¦¬ë  ë•Œê¹Œì§€ ë¬´í•œì • ëŒ€ê¸°**í•˜ê²Œ ëœë‹¤. ì´ê±´ ë‹¹ì—°í•˜ê²Œë„ ë„ˆë¬´ ë¹„íš¨ìœ¨ì ì´ë‹¤. ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ë©€í‹° ìŠ¤ë ˆë“œì˜ ì–¸ì–´ì˜€ë‹¤ë©´ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì— í•´ë‹¹ ì‘ì—…ì„ ë„˜ê¸°ê³ , ì‚¬ìš©ìì˜ interactionì„ í•  ìˆ˜ ìˆì—ˆê² ì§€ë§Œ ì•ˆíƒ€ê¹ê²Œë„ ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” **ì‹±ê¸€ ìŠ¤ë ˆë“œ ì–¸ì–´**ì´ë‹¤.

ì´ëŸ¬í•œ í•œê³„ë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•´ Event Loopê°€ ë‚˜íƒ€ë‚˜ê²Œ ë˜ì—ˆë‹¤. í•´ê²° ë°©ë²•ì€ ê½¤ ë‹¨ìˆœí•˜ë‹¤. â€˜ì§€ê¸ˆâ€™ì´ ì•„ë‹Œ **â€˜ë‚˜ì¤‘ì—â€™** ì²˜ë¦¬í•˜ê² ë‹¤ëŠ” ì „ëµì´ë‹¤. ë‚˜ì¤‘ì— ì²˜ë¦¬í•˜ëŠ” ì½”ë“œëŠ” `ajax`, `setTimeout`ê³¼ ê°™ì€ Web APIì´ë‹¤.



1. Web APIë¥¼ ì‹¤í–‰í•˜ë©´ ë¸Œë¼ìš°ì € í™˜ê²½ì—ì„œ í•´ë‹¹ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤. [Web APIëŠ” ì–´ë–»ê²Œ ë™ì‘í•˜ì§€?](##Web API)
2. ì‘ì—…ì´ ì™„ë£Œë˜ë©´ **callback** í•¨ìˆ˜ë¥¼ callback queueì— ì‹¤í–‰ ëŒ€ê¸° ìƒíƒœë¡œ ë„£ì–´ì¤€ë‹¤.
3. ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì´ ëª¨ë“  ì½”ë“œë¥¼ ë‹¤ ì‹¤í–‰í•´ì„œ call stackì´ ë¹„ê²Œ ë˜ë©´, callback queueì—ì„œ ìˆœì°¨ì ìœ¼ë¡œ í•˜ë‚˜ì”© êº¼ë‚´ì–´ **â€˜ë‚˜ì¤‘ì—â€™** ì‹¤í–‰í•˜ê²Œ ëœë‹¤.

ì´ê±¸ ì´ë¯¸ì§€ë¡œ í‘œí˜„í•˜ìë©´ ì•„ë˜ì™€ ê°™ë‹¤.
![42eatw03fcha0e1qcrf0](https://github.com/kjhwert/blogs/assets/40383255/496749e8-267e-4e30-b962-f1de18cdf0c7)

í•´ë‹¹ ì´ë¯¸ì§€ì—ëŠ” callback queueê°€ microtask queue, macrotask queue ë‘ ê°€ì§€ë¡œ ë‚˜ë‰˜ì–´ì ¸ ìˆì§€ë§Œ ì´ ë¶€ë¶„ì€ ì´í›„ì— ì„¤ëª…í•˜ê² ë‹¤.

# Callback

â€˜ì§€ê¸ˆâ€™ì´ ì•„ë‹Œ â€˜ë‚˜ì¤‘ì—â€™ê°€ ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ë¹„ë™ê¸° ì²˜ë¦¬ ì „ëµì´ë¼ëŠ” ê±¸ ì•Œê²Œ ë˜ì—ˆë‹¤. ë‚˜ì¤‘ì— ëŒì•„ì˜¤ê¸° ìœ„í•´ ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” callback í•¨ìˆ˜ë¥¼ ë‹¬ì•„ì„œ í™œìš©í•˜ê²Œ ëœë‹¤. ë°”ë¡œ 1ì„¸ëŒ€ ë¹„ë™ê¸° ì²˜ë¦¬ ë°©ë²•ì¸ ê²ƒì´ë‹¤. 
callbackì€ ë¹„ë™ê¸°ë¥¼ í‘œí˜„í•˜ê³  ê´€ë¦¬í•˜ëŠ” ê°€ì¥ ê¸°ë³¸ì ì´ê³  ì¼ë°˜ì ì¸ ë°©ë²•ì´ë‹¤. ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°œë°œìëŠ” ì˜ë„í•˜ì§€ ì•Šì•„ë„ ìì—°ìŠ¤ëŸ½ê²Œ callback íŒ¨í„´ì„ í™œìš©í•´ì„œ íë¦„ì„ ì œì–´í•˜ê³¤ í•œë‹¤.
ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ í•¨ìˆ˜ê°€ ì¼ê¸‰ í•¨ìˆ˜ì¸ ë•ë¶„ì— ì´ëŸ¬í•œ íŒ¨í„´ì´ ìƒê²¨ë‚  ìˆ˜ ìˆì—ˆê³ , ì—¬ì „íˆ ë¹„ë™ê¸°ë¥¼ í‘œí˜„í•˜ê¸°ì— ì ì ˆí•˜ê³  ìœ ìš©í•œ í‘œí˜„ì´ë‹¤. í•˜ì§€ë§Œ, ë¹„ë™ê¸°ì˜ depthê°€ ê¹Šì–´ì§€ë©´ ìƒê°ì€ ì¡°ê¸ˆ ë‹¬ë¼ì§„ë‹¤.

### ê°€ë…ì„±
í•„ìš”í•œ ë°ì´í„°ë¥¼ ì–»ê¸° ìœ„í•´ API í˜¸ì¶œì„ í•œë‹¤ê³  ê°€ì •í•˜ì.
í•˜ì§€ë§Œ í•´ë‹¹ APIë¥¼ í˜¸ì¶œí•˜ê¸° ìœ„í•´ í•„ìš”í•œ ë°ì´í„° ë˜í•œ ìš”ì²­ì„ í†µí•´ ì–»ì–´ì•¼í•œë‹¤ê³  í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ í˜•íƒœì˜ ì½”ë“œê°€ êµ¬ì„±ëœë‹¤.
```typescript
listen("click", function handler(e) {
    ajax("https://some.url.1", (res) => {
        // calculate response data
        const result = calculatedData;
        
        ajax(`https://some.url.2?someData=${result}`, (res) => {
            console.log('í™œìš©í•  ë°ì´í„°: ', res)  
        })
    })
})
```
ì¡°ê¸ˆ ê°€ë…ì„±ì´ ë–¨ì–´ì§€ê¸°ëŠ” í•˜ì§€ë§Œ, ê·¸ë˜ë„ ì•„ì§ê¹Œì§€ëŠ” ì´í•´í•˜ê¸° í¬ê²Œ ì–´ë µì§€ ì•Šë‹¤.
í•˜ì§€ë§Œ í˜„ì¬ ì½”ë“œëŠ” ì—ëŸ¬ë¥¼ ê³ ë ¤í•˜ì§€ ì•Šì•˜ë‹¤. API í˜¸ì¶œì´ ì‹¤íŒ¨í•  ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì— ì´ ë¶€ë¶„ë„ ì¶”ê°€í•´ë³´ì.
```typescript
listen("click", function handler(e) {
    ajax("https://some.url.1", (res) => {
        // calculate response data
        const result = calculatedData;
        
        ajax(`https://some.url.2?someData=${result}`, (res) => {
            console.log('í™œìš©í•  ë°ì´í„°: ', res)
        }, (err) => {
            console.error('https://some.url.2', err)
        })
    }, (err) => {
        console.error('https://some.url.1', err)
    })
})
```
ì—ëŸ¬ë¥¼ ë¶„í•  ì½œë°±ìœ¼ë¡œ ì œê³µí•œë‹¤ê³  í–ˆì„ ë•Œ ì—ëŸ¬ ìš°ì„  ì½œë°±ë³´ë‹¤ëŠ” ê·¸ë‚˜ë§ˆ ë‚«ì§€ë§Œ ì´ì¡°ì°¨ë„ ë¨¸ë¦¬ê°€ ì¡°ê¸ˆì”© ì–´ì§€ëŸ¬ì›Œì§„ë‹¤.
ì´ ìƒí™©ì—ì„œ ë˜ ë‹¤ë¥¸ APIê°€ ì¶”ê°€ëœë‹¤ê³  í•˜ë©´ ìì—°ìŠ¤ëŸ½ê²Œ í•¨ìˆ˜ë¥¼ ë‚˜ëˆ„ë ¤ëŠ” ì‹œë„ë¥¼ í•˜ê²Œ ëœë‹¤.
```typescript
listen("click", function handler(e) {
    someUrl1((res1) => someUrl2(res1, (res2) => someUrl3(res2, (res3) => {
        console.log('ë‚´ê°€ í•„ìš”í•œ ë°ì´í„°: ', res3)
    })))
})

function someUrl1(callback) {
    ajax("https://some.url.1", (res) => {
        // calculate response data
        const result = calculatedData;
        callback(result)
    }, (err) => {
        console.error('https://some.url.1', err)
    })
}

function someUrl2(params, callback) {
    ajax(`https://some.url.2?someData=${params}`, (res) => {
        // calculate response data
        const result = calculatedData;
        callback(result)
    }, (err) => {
        console.error('https://some.url.2', err)
    })
}

function someUrl3(params, callback) {
    ajax(`https://some.url.3?someData=${params}`, (res) => {
        // calculate response data
        const result = calculatedData;
        callback(result)
    }, (err) => {
        console.error('https://some.url.2', err)
    })
}
```
someUrl1 -> someUrl2 -> someUrl3 í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ì„œ ê²°êµ­ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ì–»ê¸´í–ˆì§€ë§Œ
ê° í•¨ìˆ˜ì—ì„œëŠ” ì–´ë–¤ ì²˜ë¦¬ë¥¼ í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œëŠ” ì—ë””í„°ë¥¼ ì´ë¦¬ì €ë¦¬ ì˜®ê²¨ê°€ë©° í™•ì¸í•´ì•¼ í•œë‹¤. ì½”ë“œì— ìµìˆ™ì¹˜ ì•Šë‹¤ë©´
ì´ íë¦„ì„ íŒŒì•…í•˜ê³  ë”°ë¼ê°€ëŠ” ë°ì— ë” ë§ì€ ì–´ë ¤ì›€ì„ ê²ªì„ ê²ƒì´ë‹¤. ì •ë¦¬í•˜ìë©´, ì½œë°±ì„ í†µí•œ ë¹„ë™ê¸° ì²˜ë¦¬ëŠ”
ë¹„ë™ê¸°ì˜ íë¦„ì„ **ë¹„ì„ í˜•ì , ë¹„ìˆœì°¨ì ì¸ ë°©í–¥**ìœ¼ë¡œ ë‚˜íƒ€ë‚´ê¸° ë•Œë¬¸ì— ì½”ë“œë¥¼ ì´í•´í•˜ê¸° ì–´ë µë‹¤.

### ì œì–´ì˜ ì—­ì „
ìš°ë¦¬ê°€ í”íˆ ìƒí’ˆì„ êµ¬ë§¤í•  ë•Œ ì •í•´ì§„ ì ˆì°¨ëŒ€ë¡œ ì§„í–‰ì„ í•´ì•¼í•œë‹¤. êµ¬ë§¤í•  ìƒí’ˆì„ ì£¼ë¬¸í•˜ê³ , ì£¼ë¬¸ë‚´ì—­ì„ í† ëŒ€ë¡œ ê²°ì œë¥¼ ì§„í–‰í•œë‹¤.
ê²°ì œê°€ ì™„ë£Œë˜ë©´ ì£¼ë¬¸ë‚´ì—­ì„ í™•ì¸í•  ìˆ˜ ìˆê³  ê²°ì œ ì¤‘ì— ì¿ í°ì´ë‚˜ í¬ì¸íŠ¸ ë“±ì„ ì‚¬ìš©í–ˆë‹¤ë©´ ì—…ë°ì´íŠ¸ë„ í•„ìš”í•˜ë‹¤. ì´ëŠ” ì½”ë“œë¡œ ë‹¤ìŒê³¼ ê°™ì´ í‘œí˜„í•  ìˆ˜ ìˆë‹¤.
```typescript
api.createOrder(cart,function payment(){
    api.processedToPayment(function orderSummary(){
        api.orderSummery(function updateWallet(){
            api.updateWallet();
        });     
    })
} );
```
ì¶œì²˜: [callback-hell-and-inversion-of-control](https://dailylearn.hashnode.dev/callback-hell-and-inversion-of-control)

ì½”ë“œë¥¼ ì „ë¶€ ì‘ì„±í•˜ê¸´ í–ˆì§€ë§Œ ì´ ì½”ë“œê°€ í•­ìƒ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë ê±°ë¼ê³  ë¯¿ì€ ë‚˜ë¨¸ì§€ ë°œìƒí•  ìˆ˜ ìˆëŠ” **ì—¬ëŸ¬ ì˜ˆì™¸ ìƒí™©ì— ëŒ€í•œ ê³ ë ¤**ê°€ ì „í˜€ ë˜ì–´ìˆì§€ ì•Šë‹¤. 
ì˜ˆì™¸ ì¼€ì´ìŠ¤ë¥¼ ëª‡ ê°€ì§€ ì—´ê±°í•´ë³´ìë©´
1. callbackì„ ë„ˆë¬´ ì¼ì° ë¶€ë¥¸ë‹¤. callbackìœ¼ë¡œ ì „ë‹¬í•  ë°ì´í„°ê°€ ì¶©ë¶„íˆ ì²˜ë¦¬ë˜ì§€ ì•Šì•˜ìŒì—ë„ callback í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê²Œ ë˜ë©´ í•„ìš”í•œ ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ë‹¤.
2. callbackì„ ë„ˆë¬´ ëŠ¦ê²Œ í˜¸ì¶œí•˜ê±°ë‚˜ ì•„ì˜ˆ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤. callbackì˜ ìˆœì„œì— ë”°ë¼ ì½”ë“œê°€ ì²˜ë¦¬ë˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©ìëŠ” ë¬´í•œì • ëŒ€ê¸°í•  ìˆ˜ ë°–ì— ì—†ë‹¤.
3. callbackì„ ë„ˆë¬´ ì ê²Œ ë˜ëŠ” ë„ˆë¬´ ë§ì´ ë¶€ë¥¸ë‹¤. ê°€ë ¹ callbackì„ ë§ì´ í˜¸ì¶œí•œë‹¤ë©´ í•œ ìƒí’ˆì— ëŒ€í•´ ì£¼ë¬¸ì´ë‚˜ ê²°ì œë¥¼ ì—¬ëŸ¬ë²ˆ ì§„í–‰í•˜ê²Œ ëœë‹¤.
4. `api.*` í•¨ìˆ˜ ë‚´ë¶€ì ìœ¼ë¡œ ì—ëŸ¬ê°€ ë°œìƒí–ˆì§€ë§Œ ë¬´ì‹œí•˜ê³  callbackì„ ì „ë‹¬í•˜ëŠ” ê²½ìš°. ì´ ê²½ìš°ì—ëŠ” ì£¼ë¬¸ì´ ì‹¤íŒ¨í–ˆì§€ë§Œ ì •ìƒì²˜ë¦¬ ëë‹¤ê³  íŒë‹¨í•´ ê²°ì œë‚˜ ì£¼ë¬¸ë‚´ì—­ ì²˜ë¦¬ ë“±ì„ ì§„í–‰í•˜ê²Œ ëœë‹¤.

ì´ëŸ° ì¼€ì´ìŠ¤ë“¤ì„ ê³ ë ¤í•˜ë‹¤ë³´ë©´ callback ë§ˆë‹¤ ìˆ˜ë§ì€ ì˜ˆì™¸ ì¼€ì´ìŠ¤ì— ëŒ€í•œ ë°©ì–´ ì½”ë“œë¥¼ ë§ë¶™ì—¬ ë‘ì–´ì•¼ í•  ê²ƒì´ë‹¤.

ì™œ ì´ëŸ° ì¼€ì´ìŠ¤ê°€ ë°œìƒí•˜ê²Œ ë˜ì—ˆì„ê¹Œ? `api.*` í•¨ìˆ˜ì˜ ê´€ë¦¬ ì£¼ì²´ëŠ” ë‚´ê°€ ì•„ë‹Œ ì™¸ë¶€ì´ê¸° ë•Œë¬¸ì´ë‹¤(ê·¸ ì™¸ë¶€ëŠ” ì‚¬ë‚´ì— ë‹¤ë¥¸ íŒ€ì¼ìˆ˜ë„, ì˜¤í”ˆ ì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ì¼ ìˆ˜ë„ ìˆë‹¤).
ì™¸ë¶€ ê°œë°œìê°€ ì˜ëª» ê°œë°œí•˜ì—¬ ë²„ê·¸ê°€ ë°œìƒí•œë‹¤ë©´ ë‚´ ì½”ë“œ ë˜í•œ ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤. í•˜ì§€ë§Œ ì´ëŸ° ìƒí™©ì€ ë‚´ê°€ ì»¨íŠ¸ë¡¤ í•  ìˆ˜ ì—†ë‹¤.
ê·¸ì € ì™¸ë¶€ì—ì„œ ê°€ì ¸ì˜¨ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ê°€ callbackì„ ì •í™•í•œ ì‹œì ì— í˜¸ì¶œë˜ê¸¸ ë°”ë¼ëŠ” ìˆ˜ë°–ì— ì—†ë‹¤. ì´ëŸ¬í•œ ìƒí™©ì„ ì œì–´ì˜ ì—­ì „ì´ë¼ê³  í•œë‹¤.
ë§¤ë²ˆ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ì½œë°± í•¨ìˆ˜ì— ë°˜ë³µì ì¸ ë°©ì–´ ë¡œì§ì„ ì‘ì„±í•˜ë ¤ê³  í•˜ë©´ ì ì  ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë ¤ìš´ ì½”ë“œê°€ ë˜ì–´ê°€ëŠ”ê±¸ ë°œê²¬í•˜ê²Œ ëœë‹¤.  

ì´ëŸ° ë¬¸ì œë¥¼ ì—¼ë‘í•´ë‘ê³ , promiseëŠ” ì–´ë–»ê²Œ ë¬¸ì œë¥¼ í•´ê²°í–ˆëŠ”ì§€, callback ë¬¸ì œë¥¼ ëª¨ë‘ ë³´ì™„í–ˆëŠ”ì§€ ì‚´í´ë³´ì.

# Promise


ì½œë°±ì€ ì œì–´ì˜ ì—­ì „ì´ë¼ê³  í–ˆëŠ”ë°, í”„ë¼ë¯¸ìŠ¤ë¥¼ í†µí•´ ë‹¤ì‹œ ì œì–´ê¶Œì„ íšë“í•˜ê²Œ ë˜ì—ˆë‹¤.

ì±…ì—ì„œ ì„¤ëª…í•˜ê³  ìˆëŠ” ì˜ˆì‹œê°€ promiseì— ëŒ€í•´ ì ‘ê·¼í•˜ê¸°ì— ì°¸ ì¢‹ì€ ì˜ˆì‹œë¼ëŠ” ìƒê°ì´ë‹¤.
> ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì´ë ‡ë‹¤. ë™ë„¤ íŒ¨ìŠ¤íŠ¸í‘¸ë“œ ì ì—ì„œ ë‚˜ëŠ” ì¹˜ì¦ˆ ë²„ê±° ì„¸íŠ¸ë¥¼ ë¨¹ê¸°ë¡œ í•œë‹¤. ì¹´ìš´í„° ì ì›ì—ê²Œ ì„¸íŠ¸ ë©”ë‰´ë¥¼ ì£¼ë¬¸í•˜ê³ 
> 5,500ì›ì„ ê²°ì œí•œë‹¤. ë™ì‹œì— ê±°ë˜ê°€ ì‹œì‘ëœë‹¤.
> ì£¼ë¬¸ì´ ë°€ë¦¬ë©´ ì¹˜ì¦ˆ ë²„ê±°ê°€ ë°”ë¡œ ì•ˆë‚˜ì˜¬ ìˆ˜ ìˆë‹¤. ì ì›ì€ ë‚´ê²Œ ì¹˜ì¦ˆ ë²„ê±° ëŒ€ì‹  ì£¼ë¬¸ë²ˆí˜¸ê°€ ì íŒ ì˜ìˆ˜ì¦ì„ ê±´ë„¤ì¤€ë‹¤.
> ì´ ì£¼ë¬¸ë²ˆí˜¸ëŠ” ì¼ì¢…ì˜ IOU(ë‹¹ì‹ ì—ê²Œ ë¹šì¡Œì–´ìš”)ë¡œ, ì–¸ì  ê°€ëŠ” ë°˜ë“œì‹œ ë‚´ê²Œ ì¹˜ì¦ˆ ë²„ê±°ë¥¼ ì£¼ê² ë‹¤ëŠ” **ì•½ì†(promise)**ì´ë‹¤.
> ...
> ê¸°ë‹¤ë¦¬ë©´ì„œ ì¹œêµ¬í•œí…Œ ë¬¸ì ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ë“± ë‹¤ë¥¸ ì¼ì„ í•œë‹¤. ë‚˜ëŠ” ì•„ì§ ë°›ì§€ ëª»í•œ ë¯¸ë˜ì˜ ì¹˜ì¦ˆë²„ê±°ê°€ ëˆˆ ì•ì— ìˆëŠ” ì–‘ ì‚¬ê³ í•œë‹¤.
> ë‚´ ë‘ë‡ŒëŠ” ì´ë¯¸ ì˜ìˆ˜ì¦ì— ì íŒ ì£¼ë¬¸ ë²ˆí˜¸ë¥¼ ì¹˜ì¦ˆ ë²„ê±°ì˜ ìë¦¬ë¼ì›€(placeholder)ìœ¼ë¡œ ì¸ì‹í•˜ëŠ” ëª¨ì–‘ì´ë‹¤. ì´ ìë¦¬ë¼ì›€ì€ ì‹œê°„ ë…ë¦½ì ì¸ ê°’, ì¦‰ **ë¯¸ë˜ê°’**ì´ë‹¤.
 
ì±…ì—ì„œëŠ” ì¹˜ì¦ˆ ë²„ê±° ì„¸íŠ¸ë¥¼ êµ¬ë§¤í•˜ëŠ” ìƒí™©ì„ í†µí•´ promiseë¥¼ ì„¤ëª…í•œë‹¤.
ì„¸íŠ¸ë¥¼ êµ¬ë§¤í•˜ê³  ë‚˜ë©´ ì˜ìˆ˜ì¦ì„ ë°›ëŠ”ë‹¤. ì´ ì˜ìˆ˜ì¦ì´ ë°˜ë“œì‹œ ë²„ê±° ì„¸íŠ¸ë¥¼ ì£¼ê² ë‹¤ëŠ” ì•½ì†ì´ë‹¤.
ì˜ìˆ˜ì¦ì„ ë“¤ê³  ê¸°ë‹¤ë¦¬ë©´ì„œ ë‚˜ëŠ” ë‹¤ë¥¸ ì¼ì„ í•œë‹¤. 
ì±…ì˜ ì˜ˆì‹œê°€ promiseë¥¼ ì°¸ ì˜ ì„¤ëª…í•´ì£¼ì—ˆë‹¤ê³  ìƒê°í•œë‹¤. ë§ ê·¸ëŒ€ë¡œ ì•½ì†ì´ë‹¤. ë¹„ë™ê¸°ê°€ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ë  ê²ƒì´ë¼ëŠ” ì•½ì†.
ë¬¼ë¡  ì²˜ë¦¬ëŠ” ì´í–‰ í˜¹ì€ ê±°ì ˆì´ê¸´ í•˜ê² ì§€ë§Œ, ìƒíƒœë¥¼ ë¶„ëª…íˆ ì „ë‹¬í•´ì£¼ê³  ë˜í•œ í•œë²ˆ ê²°ì •ëœ ìƒíƒœëŠ” ë¶ˆë³€í•˜ë¯€ë¡œ ì•ˆì „í•˜ë‹¤. 

1. ì–´ë–»ê²Œ ë‹¤ì‹œ ì œì–´ê¶Œì„ íšë“í–ˆë‹¤ê³  í•  ìˆ˜ ìˆì„ê¹Œ?
promiseë¡œ ë¶€í„° ì„±ê³µê³¼ ì‹¤íŒ¨ë¼ëŠ” ì´ë²¤íŠ¸ë¥¼ êµ¬ë…í•œ ìƒíƒœì—ì„œ callbackì„ ì‹¬ì–´ë‘ì—ˆë‹¤. ì„±ê³µê³¼ ì‹¤íŒ¨ëŠ” ì½”ë“œê°€ ì²˜ë¦¬ë˜ë©´ ë°˜ë“œì‹œ í•˜ë‚˜ëŠ” í˜¸ì¶œë  ê²ƒì´ê³ 
ì´ë²¤íŠ¸ êµ¬ë…ì„ í†µí•´ ìš°ë¦¬ê°€ ì œì–´í•˜ê³  ìˆëŠ” callbackìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ë‹¤.

2. ê´€ì‹¬ì‚¬ ë¶„ë¦¬. callbackì—ì„œ ë‘ ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ëª¨ë‘ ì™„ë£Œë˜ë©´ ë‘ ë°ì´í„°ë¥¼ í™œìš©í•´ ê³„ì‚°í•˜ëŠ” ë¡œì§ì´ ìˆë‹¤ê³  í•œë‹¤ë©´,
callbackì— ë‹¤ë¥¸ callbackì´ í˜¸ì¶œë˜ì–´ ë°ì´í„°ê°€ êµ¬ì„±ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ì´ í•„ìš”í•˜ë‹¤. í•˜ì§€ë§Œ promise.allì„ í™œìš©í•˜ë©´
ë°ì´í„° êµ¬ì„±ì„ í™•ì¸í•  í•„ìš”ê°€ ì—†ë‹¤.

PromiseëŠ” ê·€ê²°ë˜ê³ ë‚˜ë©´ ì™¸ë¶€ì ìœ¼ë¡œ ë¶ˆë³€ìƒíƒœì´ë¯€ë¡œ ë³€ê²½ë  ì¼ì€ ì—†ë‹¤. ì´ ë§ì€ promiseì˜ ìƒíƒœê°€ resolved í˜¹ì€ rejectedë¡œ ê·€ê²°ë˜ê³  ë‚˜ë©´ ë‹¤ë¥¸ ìƒíƒœë¡œ ë°”ë€” ì¼ì´ ì—†ë‹¤ëŠ” ë§ì´ë‹¤.
```typescript
new Promise((resolve, reject) => {
    resolve('ì™„ë£Œ')
    
    reject('ì™„ë£Œ ì•„ë‹Œë°?') // ë¬´ì‹œë¨
    resolve('ë°ì´í„° ë°”ê¿€ê±´ë°?') // ë¬´ì‹œë¨
})
```

ê·¸ëŸ¼ promiseë¥¼ í†µí•´ callbackì—ì„œ ì´ì•¼ê¸°í–ˆë˜ ë¬¸ì œë“¤ì´ ëª¨ë‘ í•´ì†Œë˜ì—ˆì„ê¹Œ? 
#### callbackì„ ë„ˆë¬´ ì¼ì° ë¶€ë¥¸ë‹¤.
then()ì„ í˜¸ì¶œí•˜ë©´ í”„ë¼ë¯¸ìŠ¤ê°€ ê·€ê²°ëœ ì´í›„ë¼ í•´ë„ then()ì— ê±´ë„¨ ì½œë°±ì€ í•­ìƒ ë¹„ë™ê¸°ì ìœ¼ë¡œë§Œ ë¶€ë¥¸ë‹¤. êµ³ì´ setTimeout(..., 0)ê³¼ ê°™ì€ ê¼¼ìˆ˜ë¥¼ ì“¸ í•„ìš”ê°€ ì—†ë‹¤.
#### callbackì„ ë„ˆë¬´ ëŠ¦ê²Œ í˜¸ì¶œí•˜ê±°ë‚˜ ì•„ì˜ˆ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤.
then()ì— ë“±ë¡í•œ ì½œë°±ì€ ìƒˆ í”„ë¼ë¯¸ìŠ¤ê°€ ìƒì„±ë˜ë©´ì„œ resolve(), reject() ì¤‘ ì–´ëŠ í•œìª½ì€ ìë™ í˜¸ì¶œí•˜ë„ë¡ ìŠ¤ì¼€ì¤„ë§ ëœë‹¤. ì´ë ‡ê²Œ ìŠ¤ì¼€ì¤„ë§ëœ ë‘ ì½œë°±ì€ ë‹¤ìŒ ë¹„ë™ê¸° ì‹œì ì— ì˜ˆìƒëŒ€ë¡œ ì‹¤í–‰ëœë‹¤.
í”„ë¼ë¯¸ìŠ¤ê°€ ê·€ê²°ë˜ë©´ then()ì— ë“±ë¡ëœ ì½œë°±ë“¤ì´ ê·¸ë‹¤ìŒ ë¹„ë™ê¸° ê¸°íšŒê°€ ì°¾ì•„ì™”ì„ ë•Œ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ë˜ë©° ì–´ëŠ í•œ ì½œë°± ë‚´ë¶€ì—ì„œ ë‹¤ë¥¸ ì½œë°±ì˜ í˜¸ì¶œì— ì˜í–¥ì„ ì£¼ê±°ë‚˜ ì§€ì—°ì‹œí‚¬ ì¼ì€ ìˆì„ ìˆ˜ ì—†ë‹¤.
```typescript
p.then(() => {
    p.then(() => {
        console.log('C')
    })
    console.log('A')
})

p.then(() => {
    console.log('B')
})
// A B C
```
ì—¬ê¸°ì„œ í”„ë¼ë¯¸ìŠ¤ ì‘ë™ ì›ë¦¬ ë•ë¶„ì— "C"ê°€ ë¼ì–´ë“¤ì–´ Bë³´ë‹¤ ë¹¨ë¦¬ í˜¸ì¶œë  ê°€ëŠ¥ì„±ì€ ì—†ë‹¤.
í•˜ì§€ë§Œ í”„ë¼ë¯¸ìŠ¤ ì²´ì´ë‹ì—ì„œëŠ” í”„ë¼ë¯¸ìŠ¤ ìŠ¤ì¼€ì¤„ë§ì— ì¡°ê¸ˆ ë” ì£¼ì˜ë¥¼ ê¸°ìš¸ì—¬ì•¼ í•œë‹¤.
ì•„ë˜ ì½”ë“œë¥¼ ë³´ë©´ p1 -> p3 -> p2ì´ê¸° ë•Œë¬¸ì— ë¡œê·¸ê°€ B, Aë¡œ ì¶œë ¥ë ê±°ë¼ ìƒê°í•  ìˆ˜ ìˆì§€ë§Œ,
í”„ë¼ë¯¸ìŠ¤ëŠ” ëª¨ë‘ ë¹„ë™ê¸° ì¡ íì— ì˜í•´ ì²˜ë¦¬ë˜ë¯€ë¡œ queueì— ìŒ“ì´ëŠ” ìˆœì„œëŠ” p1 -> p2 -> p3ê°€ ëœë‹¤.
ë”°ë¼ì„œ ì¶œë ¥ì€ A, Bê°€ ëœë‹¤.
```typescript
const p3 = new Promise(res => {
    res("B")
})

const p1 = new Promise(res => {
    res(p3)
})

const p2 = new Promise(res => {
    res('A')
})

p1.then((value) => {
    console.log(value)
})

p2.then((value) => {
    console.log(value)
})

// A B
```
#### callbackì„ ë„ˆë¬´ ì ê²Œ ë˜ëŠ” ë„ˆë¬´ ë§ì´ ë¶€ë¥¸ë‹¤.
promise.then()ì˜ í˜¸ì¶œì€ ë‹¹ì—°íˆ í•œ ë²ˆì´ë‹¤. ê·¸ë¦¬ê³  í”„ë¼ë¯¸ìŠ¤ëŠ” ë‹¨ í•œë²ˆë§Œ ê·€ê²°ëœë‹¤. ì–´ë–¤ ì´ìœ ë¡œë“  promise ë‚´ë¶€ì—ì„œ resolve, rejectë¥¼ ì—¬ëŸ¬ë²ˆ í˜¸ì¶œí•œë‹¤ê³  í•˜ë”ë¼ë„
ê·€ê²°ëœ ìƒíƒœê°€ ë³€ê²½ë˜ê±°ë‚˜ ì¬í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.

#### ì—ëŸ¬/ì˜ˆì™¸
í”„ë¼ë¯¸ìŠ¤ê°€ ìƒì„± ì¤‘ ë˜ëŠ” ê·€ê²°ì„ ê¸°ë‹¤ë¦¬ëŠ” ë„ì¤‘ ì–¸ì œë¼ë„ TypeError, ReferenceError ë“±ì˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—ëŸ¬ê°€ ë‚˜ë©´ ì˜ˆì™¸ë¥¼ ì¡ì•„ ì£¼ì–´ì§„ í”„ë¼ë¯¸ìŠ¤ë¥¼ ê°•ì œë¡œ ë²„ë¦°ë‹¤.
ê·¸ë ‡ë‹¤ë©´ promise.then()ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ?
```typescript
const p = new Promise((resolve) => {
    resolve()
})

p.then(() => {
    console.log(msg)
}, () => {
    console.log('rejected') // í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.
})

// Promise Rejected: ReferenceError: msg is not defined
```
p.then()ê°€ ë°˜í™˜í•œ ë˜ ë‹¤ë¥¸ í”„ë¼ë¯¸ìŠ¤ì—ì„œ TypeError ì—ì™¸ê°€ ë‚˜ë©´ì„œ ë²„ë ¤ì§€ê²Œ ëœë‹¤. then()ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²½ìš° rejectedë¡œ ê·€ê²°ì‹œí‚¤ë©´ ë˜ì§€ ì•Šì„ê¹Œ ì‹¶ê¸°ëŠ” í•˜ì§€ë§Œ,
ê·¸ë ‡ê²Œ ëœë‹¤ë©´ í”„ë¼ë¯¸ìŠ¤ì˜ ê·€ê²°ëœ ìƒíƒœëŠ” ë¶ˆë³€ì´ë‹¤ëŠ” ëª…ì œê°€ ì§€ì¼œì§€ì§€ ì•Šê²Œ ëœë‹¤. ë˜í•œ í”„ë¼ë¯¸ìŠ¤ì— then() ì½œë°±ì´ ì—¬ëŸ¬ê°œ ë“±ë¡ë˜ì–´ ìˆëŠ” ìƒíƒœì—ì„œ ì–´ë–¤ ì½œë°±ì€ í˜¸ì¶œí•˜ê³  ì–´ë–¤ ì½œë°±ì€ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ í˜¼ë€ì„ ì•¼ê¸°í•  ìˆ˜ ìˆë‹¤.

## Promise.resolve()
1. thenableì´ì§€ë§Œ Promiseê°€ ì•„ë‹Œ ê°’ì— ëŒ€í•´ í”„ë¼ë¯¸ìŠ¤ë¡œ ì •ê·œí™”í•  ìˆ˜ ìˆë‹¤.
```typescript
const p = {
    then: function(cb, errcb) {
        cb(42);
        errcb("ì‚¬ì•…í•œ ë¯¸ì†Œ");
    }
};

p.then(function fulfilled(value) {
    console.log('fulfilled',value)
}, function rejected(error) {
    console.log('error',error) // í˜¸ì¶œë˜ë©´ ì•ˆëœë‹¤.
})
```
pëŠ” thenable ì´ì§€ë§Œ í”„ë¼ë¯¸ìŠ¤ì²˜ëŸ¼ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´ëŸ¬í•œ ì¼€ì´ìŠ¤ê°€ ìˆë‹¤ëŠ”ê±´ ê·¸ë§Œí¼ í”„ë¼ë¯¸ìŠ¤ì— ëŒ€í•œ ì‹ ë¢°ê°€ ë‚®ì•„ì§ˆ ìˆ˜ ìˆë‹¤ëŠ” ë§ì´ë‹¤. í•˜ì§€ë§Œ, ì–´ë–¤ ë°ì´í„°ì—¬ë„ Promise.resolve()ì— ë„£ìœ¼ë©´
ì •ê·œí™”í•˜ë¯€ë¡œ ì•ˆì „í•œ ê²°ê³¼ë¥¼ ê¸°ëŒ€í•  ìˆ˜ ìˆë‹¤.
```typescript
Promise.resolve(p).then(...)
```
2. íŠ¹ì • í•¨ìˆ˜ê°€ ê²½ìš°ì— ë”°ë¼ ì¦‰ì‹œ ê°’ì„ ë°˜í™˜í•˜ê±°ë‚˜ Promiseë¥¼ ë°˜í™˜í•˜ëŠ” ê²½ìš°ë¼ë©´ Promise.resolve()ë¡œ ê°ì‹¸ë©´ ë°˜í™˜ê°’ì„ í•­ìƒ Promiseë¡œ ê³ ì •í•  ìˆ˜ ìˆë‹¤.
3. Promise.resolveëŠ” ì§„ì§œ í”„ë¼ë¯¸ìŠ¤ë¥¼ ë°›ìœ¼ë©´ ë„ë¡œ ë±‰ì–´ë‚´ê³ , ë°ë„ˆë¸”ì„ ë°›ìœ¼ë©´ ì¼ë‹¨ í•œë²ˆ í’€ì–´ë³´ê³  ì•„ë‹ˆë©´ ì›í•˜ëŠ” ê°’ì´ ë‚˜ì˜¬ë•Œê¹Œì§€ ì¬ê·€ì ìœ¼ë¡œ ê³„ì† í’€ì–´ë³¸ë‹¤.

## Promise Chaining
> ë¹„ë™ê¸°ì˜ ì—°ì‡„ë¥¼ ë‚˜íƒ€ë‚¼ ë•Œ Promise chainingì„ ì“°ë©´ ì¢‹ê² ì§€ë§Œ, ê·¸ ìƒí™©ì´ ì–¸ì œì¼ê¹Œ..?

ë‹¹ì—°íˆ ì—°ì†ì ìœ¼ë¡œ API í˜¸ì¶œì„ í•˜ëŠ” ìƒí™©ì´ê² ì§€ë§Œ, ë‘ ì„¸ë²ˆ ì •ë„ì˜ api chaining ì´ë¼ë©´ await ìœ¼ë¡œ ë‚˜íƒ€ë‚´ë„ í¬ê²Œ ë¬¸ì œ ì—†ì§€ ì•Šì„ê¹Œ?...
ê°ê°ì˜ APIì— ëŒ€í•´ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•´ì•¼í•  ë•Œ ìœ ìš©í• ê¹Œ?
í”„ë¼ë¯¸ìŠ¤ ì²´ì´ë‹ì€ ë‹¤ë‹¨ê²Œ ë¹„ë™ê¸° ì‹œí€€ìŠ¤ì—ì„œ íë¦„ ì œì–´ ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¨ê³„ì™€ ë‹¨ê³„ ì‚¬ì´ì— ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•˜ëŠ” ì±„ë„ë¡œë„ ì“°ì¸ë‹¤.
í”„ë¼ë¯¸ìŠ¤ ì—°ì‡„ì˜ ì–´ëŠ ë‹¨ê³„ì—ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ì—ëŸ¬/ì˜ˆì™¸ëŠ” í”„ë¼ë¯¸ìŠ¤ ë‹¨ìœ„ë¡œ í•œì •ë˜ë¯€ë¡œ ì „ì²´ ì—°ì‡„ ì–´ëŠ ê³³ì—ì„œ ë‚œ ì—ëŸ¬ë¼ë„ ëª¨ë‘ ì¡ì•„ ë°”ë¡œ ê·¸ ì§€ì ë¶€í„° ë¦¬ì…‹ì„ í•˜ì—¬ ì—°ì‡„ë¥¼ ë‹¤ì‹œ ì •ìƒ ê°€ë™ì‹œí‚¨ë‹¤.
```typescript
Promise.resolve('https://some.url')
// 2ë‹¨ê³„
.then(res => {
    foo.bar(); // ì •ì˜ë˜ì§€ ì•Šì•˜ìœ¼ë‹ˆ ì—ëŸ¬ ë°œìƒ
    
    return Promise.resolve('https://some.url2')
})
// 3ë‹¨ê³„
.then(function fulfilled() {
    // ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.
}, function rejected(err) {
    console.log('error', err) // foo is not defined
    
    return 42;
})
// 4ë‹¨ê³„
.then((msg) => {
    console.log(msg) // 42
})
```
2ë‹¨ê³„ì—ì„œ ì—ëŸ¬ê°€ ë‚˜ë©´ 3ë‹¨ê³„ rejectê°€ ì´ë¥¼ ì¡ì•„ í•„ìš”ì‹œ ì–´ë–¤ ê°’(42)ì„ ë°˜í™˜í•´ ë‹¤ìŒ 4ë‹¨ê³„ì˜ í”„ë¼ë¯¸ìŠ¤ê°€ ì´ë£¨ì–´ì§€ê²Œ í•œë‹¤. ì´ëŸ° ì‹ìœ¼ë¡œ ì „ì²´ ì—°ì‡„ëŠ” ë‹¤ì‹œ resolve ìƒíƒœë¡œ ëŒì•„ê°„ë‹¤.

#### í”„ë¼ë¯¸ìŠ¤ ì²´ì´ë‹ì—ì„œì˜ ì—ëŸ¬ì²˜ë¦¬
í”„ë¼ë¯¸ìŠ¤ ì²´ì´ë‹ì—ì„œì˜ ì—ëŸ¬ì²˜ë¦¬ëŠ” í”„ë¼ë¯¸ìŠ¤ë‹¹ ì˜ˆì™¸ì²˜ë¦¬(catch)ë¥¼ í•˜ê³ , ì´ì–´ì„œ í•¸ë“¤ëŸ¬ë¥¼ ì§„í–‰í•˜ë©´ ëœë‹¤.
```typescript
new Promise((resolve, reject) => {
    throw new Error('ì—ëŸ¬ ë°œìƒ!')
}).catch(err => {
    alert('ì—ëŸ¬ê°€ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.')
}).then(() => {
    alert('ë‹¤ìŒ í•¸ë“¤ëŸ¬ê°€ ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.')
})
```
í•˜ì§€ë§Œ catchì—ì„œë„ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ë©´, ê·¸ ë‹¤ìŒ í•¸ë“¤ëŸ¬ëŠ” resolveê°€ ì•„ë‹Œ reject(catch)ì—ì„œ ì²˜ë¦¬ëœë‹¤.
```typescript
new Promise((resolve, reject) => {
    throw new Error('ì—ëŸ¬ ë°œìƒ!')
}).catch(err => {
    throw new Error('ì•— ë˜ ì—ëŸ¬ê°€ ë°œìƒí–ˆë„¤ìš”')
}).then(() => {
    // í˜¸ì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
}).catch(() => {
    alert('ìê¾¸ ì—ëŸ¬ê°€ ë°œìƒí•˜ë„¤ìš”')
})
```
---

You Donâ€™t Know JS [thisì™€ ê°ì²´ í”„ë¡œí† íƒ€ì…, ë¹„ë™ê¸°ì™€ ì„±ëŠ¥]
https://ko.javascript.info/callbacks
https://ko.javascript.info/promise-basics
https://ko.javascript.info/event-loop
[https://inpa.tistory.com/entry/ğŸŒ-js-async](https://inpa.tistory.com/entry/%F0%9F%8C%90-js-async)
https://www.youtube.com/watch?v=8aGhZQkoFbQ
